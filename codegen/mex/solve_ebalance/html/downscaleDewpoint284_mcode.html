<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="60,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">Td</span>,<span class="var type1" id="S3T1U4">ea</span>]=downscaleDewpoint(<span class="var type1" id="S4T1U7">pres_coarse</span>,<span class="var type1" id="S5T1U8">q_coarse</span>,<span class="var type1" id="S6T1U9">T_coarse</span>,<span class="var type1" id="S7T1U10">T_fine</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="60,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Dewpoint in degrees K</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% in: </span></span></span>
<span class="srcline"><span class="lineno"><a href="60,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% pres - coarse air pressure, kPa</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% q - coarse specific humidity, kg/kg</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% T_coarse, coarse air temp, K</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% T_fine, downscaled air temp, K</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% out: </span></span></span>
<span class="srcline"><span class="lineno"><a href="60,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% Td, dewpoint in deg K</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,10" id="srcline10">10</a></span><span class="line"><span class="comment">% ea, vapor pressure of air, kPa</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="60,12" id="srcline12">12</a></span><span class="line"><span class="comment">%fix zero and negative values</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T1:U7"><span class="var type1" id="S8T1U13">thresh</span>=<span class="mxinfo " id="T1:U9">7e-5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T17:U10"><span class="mxinfo " id="T17:U11"><span class="var type1" id="S5T1U18">q_coarse</span>( <span class="mxinfo " id="T2:U13"><span class="var type1" id="S5T1U20">q_coarse</span> &lt; <span class="var type1" id="S8T1U21">thresh</span></span>)</span> = <span class="var type1" id="S8T1U22">thresh</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,15" id="srcline15">15</a></span><span class="line"><span class="comment">%vapor pressure, kPa, Peixoto and Oort (1996) Eq 3, p 3445</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T1:U17"><span class="var type1" id="S9T1U25">ea_coarse</span>=<span class="mxinfo " id="T1:U19"><span class="mxinfo " id="T1:U20"><span class="var type1" id="S5T1U28">q_coarse</span>.*<span class="var type1" id="S4T1U29">pres_coarse</span></span>/0.622</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,17" id="srcline17">17</a></span><span class="line"><span class="comment">%compute rh</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,18" id="srcline18">18</a></span><span class="line"><span class="comment">%assume rh constant between coarse and fine pixels</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T1:U23"><span class="var type1" id="S10T1U33">rh</span>=<span class="mxinfo " id="T1:U25"><span class="var type1" id="S9T1U35">ea_coarse</span>./<span class="mxinfo " id="T1:U27"><span class="fcn" id="F158N2:B37">SaturationVaporPressure</span>(<span class="var type1" id="S6T1U38">T_coarse</span>,<span class="string">'water'</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,20" id="srcline20">20</a></span><span class="line"><span class="comment">%recalc if any pix below freezing</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,21" id="srcline21">21</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T2:U29">any(<span class="mxinfo " id="T2:U30"><span class="var type1" id="S6T1U46">T_coarse</span>(:)&lt;=<span class="mxinfo " id="T1:U32">0</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T2:U33"><span class="var type1" id="S13T2U51">idx</span>=<span class="mxinfo " id="T2:U35"><span class="var type1" id="S6T1U53">T_coarse</span> &lt;= <span class="mxinfo " id="T1:U37">0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo " id="T17:U38"><span class="mxinfo " id="T17:U39"><span class="var type1" id="S10T1U58">rh</span>(<span class="var type1" id="S13T2U59">idx</span>)</span>=<span class="mxinfo " id="T17:U42"><span class="mxinfo " id="T17:U43"><span class="var type1" id="S9T1U62">ea_coarse</span>(<span class="var type1" id="S13T2U63">idx</span>)</span>./<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,24" id="srcline24">24</a></span><span class="line">        <span class="mxinfo " id="T17:U46"><span class="fcn" id="F225N2:B65">SaturationVaporPressure</span>(<span class="mxinfo " id="T17:U47"><span class="var type1" id="S6T1U67">T_coarse</span>(<span class="var type1" id="S13T2U68">idx</span>)</span>,<span class="string">'ice'</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,25" id="srcline25">25</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="60,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T17:U50"><span class="mxinfo " id="T17:U51"><span class="var type1" id="S10T1U73">rh</span>(<span class="mxinfo " id="T2:U53"><span class="var type1" id="S10T1U75">rh</span> &lt; <span class="mxinfo " id="T1:U55">0.01</span></span>)</span> = <span class="mxinfo " id="T1:U56">0.01</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T17:U57"><span class="mxinfo " id="T17:U58"><span class="var type1" id="S10T1U81">rh</span>(<span class="mxinfo " id="T2:U60"><span class="var type1" id="S10T1U83">rh</span> &gt; <span class="mxinfo " id="T1:U62">1</span></span>)</span> = <span class="mxinfo " id="T1:U63">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="60,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T1:U64"><span class="var type1" id="S14T1U88">T_fineC</span>=<span class="mxinfo " id="T1:U66"><span class="var type1" id="S7T1U90">T_fine</span>-273.15</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="60,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T1:U68"><span class="var type1" id="S15T1U94">b</span>=<span class="mxinfo " id="T1:U70">zeros(size(<span class="var type1" id="S14T1U99">T_fineC</span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T1:U72"><span class="var type1" id="S18T1U102">c</span>=<span class="mxinfo " id="T1:U74">zeros(size(<span class="var type1" id="S14T1U107">T_fineC</span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo " id="T1:U76"><span class="var type1" id="S15T1U111">b</span>(:,:)=<span class="mxinfo " id="T1:U78">22.587</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo " id="T1:U79"><span class="var type1" id="S18T1U118">c</span>(:,:)=<span class="mxinfo " id="T1:U81">273.86</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,36" id="srcline36">36</a></span><span class="line"><span class="comment">%recalc for below freezing</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,37" id="srcline37">37</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T2:U82">any(<span class="mxinfo " id="T2:U83"><span class="var type1" id="S14T1U128">T_fineC</span>(:)&lt;=<span class="mxinfo " id="T1:U85">0</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T17:U86"><span class="mxinfo " id="T17:U87"><span class="var type1" id="S15T1U134">b</span>(<span class="mxinfo " id="T2:U89"><span class="var type1" id="S14T1U136">T_fineC</span>&lt;=<span class="mxinfo " id="T1:U91">0</span></span>)</span>=<span class="mxinfo " id="T1:U92">17.625</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo " id="T17:U93"><span class="mxinfo " id="T17:U94"><span class="var type1" id="S18T1U142">c</span>(<span class="mxinfo " id="T2:U96"><span class="var type1" id="S14T1U144">T_fineC</span>&lt;=<span class="mxinfo " id="T1:U98">0</span></span>)</span>=<span class="mxinfo " id="T1:U99">243.04</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,40" id="srcline40">40</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,41" id="srcline41">41</a></span><span class="line"><span class="comment">% Rayleigh et al (2013) doi:10.1002/2013WR013958</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T1:U100"><span class="var type1" id="S19T1U149">TdC</span>=<span class="mxinfo " id="T1:U102"><span class="mxinfo " id="T1:U103"><span class="var type1" id="S18T1U152">c</span>.*(<span class="mxinfo " id="T1:U105"><span class="mxinfo " id="T1:U106">log(<span class="var type1" id="S10T1U157">rh</span>)</span>+<span class="mxinfo " id="T1:U108"><span class="mxinfo " id="T1:U109"><span class="var type1" id="S15T1U160">b</span>.*<span class="var type1" id="S14T1U161">T_fineC</span></span>./(<span class="mxinfo " id="T1:U112"><span class="var type1" id="S18T1U164">c</span>+<span class="var type1" id="S14T1U165">T_fineC</span></span>)</span></span>)</span>./<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,43" id="srcline43">43</a></span><span class="line">(<span class="mxinfo " id="T1:U115"><span class="mxinfo " id="T1:U116"><span class="var type1" id="S15T1U169">b</span>-<span class="mxinfo " id="T1:U118">log(<span class="var type1" id="S10T1U172">rh</span>)</span></span>-<span class="mxinfo " id="T1:U120"><span class="mxinfo " id="T1:U121"><span class="var type1" id="S15T1U175">b</span>.*<span class="var type1" id="S14T1U176">T_fineC</span></span>./(<span class="mxinfo " id="T1:U124"><span class="var type1" id="S18T1U179">c</span>+<span class="var type1" id="S14T1U180">T_fineC</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,44" id="srcline44">44</a></span><span class="line"><span class="comment">%convert to K</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo " id="T1:U127"><span class="var type1" id="S2T1U183">Td</span>=<span class="mxinfo " id="T1:U129"><span class="var type1" id="S19T1U185">TdC</span>+273.15</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,46" id="srcline46">46</a></span><span class="line"><span class="comment">%use Td in sat. formula to obtain actual vapor pressure</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo " id="T1:U131"><span class="var type1" id="S3T1U189">ea</span>=<span class="mxinfo " id="T1:U133"><span class="fcn" id="F158N2:B191">SaturationVaporPressure</span>(<span class="var type1" id="S2T1U192">Td</span>,<span class="string">'water'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,48" id="srcline48">48</a></span><span class="line"><span class="comment">%recalc if below freezing</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,49" id="srcline49">49</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T2:U135">any(<span class="mxinfo " id="T2:U136"><span class="var type1" id="S14T1U200">T_fineC</span>(:)&lt;=<span class="mxinfo " id="T1:U138">0</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T2:U139"><span class="var type1" id="S13T2U205">idx</span>=<span class="mxinfo " id="T2:U141"><span class="var type1" id="S14T1U207">T_fineC</span>&lt;=<span class="mxinfo " id="T1:U143">0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,51" id="srcline51">51</a></span><span class="line">    <span class="mxinfo " id="T17:U144"><span class="mxinfo " id="T17:U145"><span class="var type1" id="S3T1U212">ea</span>(<span class="var type1" id="S13T2U213">idx</span>)</span>=<span class="mxinfo " id="T17:U148"><span class="fcn" id="F225N2:B215">SaturationVaporPressure</span>(<span class="mxinfo " id="T17:U149"><span class="var type1" id="S2T1U217">Td</span>(<span class="var type1" id="S13T2U218">idx</span>)</span>,<span class="string">'ice'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="60,52" id="srcline52">52</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="60,53" id="srcline53">53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="60,54" id="srcline54">54</a></span><span class="line"><span class="comment">% a=0.6112;% kPa</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,55" id="srcline55">55</a></span><span class="line"><span class="comment">% b=17.67;</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,56" id="srcline56">56</a></span><span class="line"><span class="comment">% c=243.5;% deg C</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,57" id="srcline57">57</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="60,58" id="srcline58">58</a></span><span class="line"><span class="comment">% Td=(c.*log(ea./a))./(b-log(ea./a));</span></span></span>
<span class="srcline"><span class="lineno"><a href="60,59" id="srcline59">59</a></span><span class="line"><span class="comment">% Td=Td+273.15; % convert to K</span></span></span>
</pre>
</body>
</html>
